# System Design социальной сети для путешественников

## Функциональные требования:

### Управление пользователями
- Регистрация нового пользователя (по email/login + password)
- Аутентификация пользователя 
- Просмотр и редактирование профиля пользователя
- Деактивация/удаление пользователя

### Управление/взаимодействие с постами  
- Создание поста пользователем (фотографии (JPG, PNG), описание, геолокация)
- Просмотр собственных постов пользователем
- Редактирование собственных постов пользователем
- Удаление собственного поста
- Просмотр постов других пользователей
- Оценка постов других пользователей (лайк)

### Управление подписками
- Подписка на пользователя
- Отписка от пользователя

### Поиск интересных мест
- поиск популярных мест (отсортированных по популярности)
- просмотр постов, связанных с выбранным местом (геолокация)

### Лента новостей
- просмотр постов пользователей, на которые подписался текущий пользователь (в обратном хронологическом порядке)


## Нефункциональные требования:
### Аудитория
- 10М DAU в первый год -> 20M DAU во второй (линейный рост)
- Регион - СНГ
- Трафик - в основном мобильный (80/20, где 80% - мобильный, 20% - десктопный)

### Активность пользователя
### Сезонность
- В высокий сезон активность будет возрастать в 2-3 раза

### Лимиты
- 100 подписок/день
- 200 лайков/день
- 50 постов/день


### Производительность
#### Latency
- Latency P99 <= 300ms для основных API (просмотр ленты, лайк, открытие поста, подписка)
- Latency P99 <= 500ms для поиска (места, пользователи)
- Latency P99 <= 1 sec при загрузке фото

#### Throughput
Система должна выдерживать нагрузку 15M DAU с учетом линейного роста нагрузки к середине второго года
Коэффициент пиковой нагрузки - 3-5 (в среднем - x4)
Коэффициент сезонной нагрузки - 2-3 (в среднем - x2.5)

RPS (read) (без учета сезонного коэффициента):
- Просмотр ленты подписок (50 постов с пагинацией по 20 постов):
  - средний rRps: (50 * 15M DAU) / 86400 = 8680 
  - пиковый rRps: 8680 * 4 = 37720 
  
- Просмотр ленты интересных мест (30 постов):
  - средний rRps: (30 * 15M DAU) / 86400 = 8680
  - пиковый rRps: 8680 * 4 = 37720
  
- Просмотр профилей:
  - средний rRps: (10 * 15M DAU) / 86400 = 1730
  - пиковый rRps: 1730 * 4 = 6940
  
- Просмотр поста:
  - средний rRps: (20 * 15M DAU) / 86400 = 3470
  - пиковый rRps: 3470 * 4 = 13880

_Итого:_ 22560 / 90240 (среднее/пиковое)


RPS (write) (без учета сезонного коэффициента):
- Создание поста (1 пост в 5 дней = 0.2): 
  - средний wRPS: (0.2 * 15M DAU) / 86400 = 34
  - пиковый wRPS: 34 * 4 = 136

- Реакция (20 лайков/день):
  - средний wRPS: (20 * 15M DAU) / 86400 = 3470
  - пиковый wRPS: 3470 * 4 = 13880

- Подписка/Отписка:
  - средний wRPS: (2 * 15M DAU) / 86400 = 347
  - пиковый wRPS: 347 * 4 = 1388

_Итого:_ 3850 / 15400 (среднее/пиковое)

Подавляющая нагрузка - Чтение (rRPS = 85%, wRPS = 15%).
Система должна быть оптимизирована _**под чтение**_.

#### Traffic
Преобладает исходящий трафик

**GET /posts**
  - metadata: 420 bytes * 20 * 8680 rps / 1000000 = 72 MB/sec (пик - 288 MB/sec)
  - media: 1 photo * 20 * 300 KB (после полного сжатия) * 8680 rps / 1000000 = 52 GB/sec (пик - 200 Gb/sec) 

**GET /posts/{post_id}**
  - metadata: 1120 bytes * 3470 rps / 1000000 = 3,89 MB/sec (пик - 15,55 MB/sec)
  - media: 3 photos * 300 KB (после полного сжатия) * 3470 rps / 1000000 = 3,36 GB/sec (пик - 13,46 Gb/sec)

**POST /posts**
  - metadata: (1120 bytes * 34) / 1000 = 38,8 KB/sec (пик - 152 KB/sec) 
  - media: 3 * 1500 KB (после первичного сжатия на клиенте) * 34 / 1000000 = 0,15 Gb/sec

**GET /users/{user_id}**
  - metadata: 542 bytes * 1730 rps / 1000000 = 0,9 MB/sec (пик - 3,6 MB/sec)
  - media: 100 KB (после полного сжатия) * 1730 rps / 1000000 = 100 MB/sec (пик - 400 MB/sec)

**GET /posts/{post_id}/likes**
  - metadata: 542 bytes * 1730 rps / 1000000 = 0,9 MB/sec (пик - 3,6 MB/sec)
